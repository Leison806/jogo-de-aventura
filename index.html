import random
import time

# --- 1. DEFINI√á√ïES GLOBAIS ---
PONTOS_DE_ATRIBUTO = 10
MAX_PONTOS_NEVOA = 20

# --- 2. CLASSES E OBJETOS ---

class Personagem:
    """Representa o personagem do jogador."""
    def __init__(self, nome, arquetipo, forca, destreza, mente):
        self.nome = nome
        self.arquetipo = arquetipo
        self.forca = forca
        self.destreza = destreza
        self.mente = mente
        self.pontos_nevoa = 0
        self.vida = 10 + (forca * 5) # Vida inicial baseada em For√ßa

    def mostrar_status(self):
        """Exibe o estado atual do personagem."""
        print("-" * 30)
        print(f"| NOME: {self.nome}")
        print(f"| ARQU√âTIPO: {self.arquetipo}")
        print(f"| VIDA: {self.vida}")
        print(f"| FOR: {self.forca} | DES: {self.destreza} | MEN: {self.mente}")
        print(f"| PONTOS DE N√âVOA (PN): {self.pontos_nevoa}/{MAX_PONTOS_NEVOA}")
        self.verificar_punicao()
        print("-" * 30)

    def verificar_punicao(self):
        """Verifica e exibe as puni√ß√µes da N√©voa."""
        if self.pontos_nevoa >= 15:
            print("‚ùó INSTABILIDADE: Penalidade em todos os testes f√≠sicos e mentais.")
        elif self.pontos_nevoa >= 10:
            print("‚ùó CONFUS√ÉO: Penalidade em testes de Mente.")
        elif self.pontos_nevoa >= 5:
            print("‚ùó PARAN√ìIA: Penalidade em testes sociais.")

class Monstro:
    """Representa um inimigo (Monstro Corrompido)."""
    def __init__(self, nome, vida, dano, dificuldade_base=15):
        self.nome = nome
        self.vida = vida
        self.dano = dano
        self.dificuldade_base = dificuldade_base

# --- 3. SISTEMA DE REGRAS (Mec√¢nicas) ---

def rolar_d20(jogador, atributo):
    """Rola um d20 e aplica o b√¥nus do atributo (FOR, DES, ou MEN)."""
    d20 = random.randint(1, 20)
    
    # Aplica o atributo
    bonus = 0
    if atributo == 'FOR':
        bonus = jogador.forca
    elif atributo == 'DES':
        bonus = jogador.destreza
    elif atributo == 'MEN':
        bonus = jogador.mente

    # Aplica puni√ß√£o da N√©voa (simplificada)
    penalidade_nevoa = 0
    if jogador.pontos_nevoa >= 15:
        penalidade_nevoa = -1
    elif jogador.pontos_nevoa >= 10 and atributo == 'MEN':
        penalidade_nevoa = -1

    resultado_final = d20 + bonus + penalidade_nevoa

    print(f"üé≤ Rolagem de d20 ({atributo}): {d20} + {bonus} ({atributo}) + {penalidade_nevoa} (N√©voa) = **{resultado_final}**")
    return resultado_final

def teste_atributo(jogador, atributo, cd):
    """Executa um Teste de Atributo contra uma Dificuldade (CD)."""
    resultado = rolar_d20(jogador, atributo)
    if resultado >= cd:
        print(f"‚úÖ SUCESSO! O resultado ({resultado}) atinge ou excede a Dificuldade ({cd}).")
        return True
    else:
        print(f"‚ùå FALHA! O resultado ({resultado}) √© inferior √† Dificuldade ({cd}).")
        if atributo == 'MEN' and random.random() < 0.3: # Chance de ganhar N√©voa na falha de Mente
            jogador.pontos_nevoa += 1
            print(">> A falha em Mente exp√µe voc√™ √† N√©voa! +1 PN.")
        return False

def combate_simples(jogador, inimigo):
    """Simula√ß√£o de um turno de combate simples."""
    print(f"\n--- IN√çCIO DO COMBATE CONTRA {inimigo.nome} ---")

    while jogador.vida > 0 and inimigo.vida > 0:
        time.sleep(1)
        jogador.mostrar_status()
        print(f"Oponente: {inimigo.nome} | Vida: {inimigo.vida}")
        
        # Turno do Jogador: Ataque com For√ßa
        print("\nSeu turno: Atacar!")
        cd_ataque = inimigo.dificuldade_base
        if teste_atributo(jogador, 'FOR', cd_ataque):
            dano_causado = 5 + jogador.forca
            inimigo.vida -= dano_causado
            print(f"‚ú® Voc√™ atinge o {inimigo.nome} e causa {dano_causado} de dano!")
        else:
            print("O ataque falha! O inimigo se esquiva ou sua arma erra o alvo.")

        if inimigo.vida <= 0:
            print(f"\nüéâ VIT√ìRIA! Voc√™ derrota o {inimigo.nome}!")
            break

        time.sleep(1)
        
        # Turno do Inimigo: Contra-ataque
        print(f"\nTurno do {inimigo.nome}: Ele contra-ataca!")
        
        # Tenta esquivar com Destreza
        cd_esquiva = 10 + (jogador.destreza // 2) # Dificuldade de esquiva aumenta com sua Destreza
        
        if teste_atributo(jogador, 'DES', cd_esquiva):
            print("üí® Voc√™ √© √°gil e consegue esquivar do golpe!")
        else:
            dano_recebido = inimigo.dano
            jogador.vida -= dano_recebido
            print(f"ü§ï Voc√™ √© atingido e recebe {dano_recebido} de dano.")

        if jogador.vida <= 0:
            print("\nüíÄ DERROTA! A Neblina reivindica mais um corpo. Fim do Jogo.")
            break

# --- 4. FLUXO DO JOGO ---

def criar_personagem():
    """Fun√ß√£o para guiar a cria√ß√£o do personagem."""
    print("## üë§ CRIA√á√ÉO DE PERSONAGEM ##")
    nome = input("Qual o nome do seu aventureiro? ")
    
    arquetipos = ['Guerreiro', 'Patrulheiro', 'S√°bio', 'Vagante']
    print("Escolha seu Arqu√©tipo:")
    for i, arq in enumerate(arquetipos):
        print(f"[{i+1}] {arq}")
    
    escolha = 0
    while escolha not in [1, 2, 3, 4]:
        try:
            escolha = int(input("Digite o n√∫mero do Arqu√©tipo: "))
            arquetipo = arquetipos[escolha - 1]
        except (ValueError, IndexError):
            escolha = 0
            print("Escolha inv√°lida. Tente novamente.")

    # Distribui√ß√£o de Atributos
    pontos_restantes = PONTOS_DE_ATRIBUTO
    print(f"\nVoc√™ tem {pontos_restantes} pontos para distribuir em FOR, DES e MEN (Min 1, Max 5).")

    forca = 0
    destreza = 0
    mente = 0

    while pontos_restantes > 0:
        print(f"Pontos restantes: {pontos_restantes}")
        
        try:
            forca = min(5, int(input(f"Pontos em FOR√áA (Min 1): ")))
            destreza = min(5, int(input(f"Pontos em DESTREZA (Min 1): ")))
            mente = min(5, int(input(f"Pontos em MENTE (Min 1): ")))
            
            soma = forca + destreza + mente
            
            if soma == PONTOS_DE_ATRIBUTO and forca >= 1 and destreza >= 1 and mente >= 1:
                pontos_restantes = 0
            else:
                print(f"A soma dos pontos deve ser exatamente {PONTOS_DE_ATRIBUTO} (e no m√≠nimo 1 em cada). Tente novamente.")
        except ValueError:
            print("Entrada inv√°lida. Use apenas n√∫meros.")

    return Personagem(nome, arquetipo, forca, destreza, mente)

def introducao_e_primeira_aventura(jogador):
    """Executa a primeira cena do jogo."""
    print("\n" * 5)
    print("=" * 50)
    print("Ecos da Antiga Neblina: O Vilarejo Esquecido")
    print("=" * 50)
    print(f"O bravo(a) {jogador.nome}, um(a) {jogador.arquetipo}, chega aos limites de Aethelgard.")
    time.sleep(2)
    print("Voc√™ est√° na orla da Floresta de Musgo, onde a 'Antiga Neblina' √© mais densa.")
    print("O ar √© frio e pesado, e voc√™ ouve um lamento distante.")
    time.sleep(2)

    # CEN√ÅRIO 1: O Teste de Investiga√ß√£o
    print("\nVoc√™ encontra uma cabana abandonada, parcialmente engolida pela n√©voa.")
    escolha = input("[1] Entrar e investigar. [2] Contornar e seguir adiante. (Digite 1 ou 2): ")

    if escolha == '1':
        print("\nVoc√™ entra na escurid√£o. O cheiro de mofo e corrup√ß√£o √© forte.")
        print("Voc√™ tenta encontrar alguma pista sobre a origem da Neblina...")
        cd_investigacao = 15
        
        if teste_atributo(jogador, 'MEN', cd_investigacao):
            print("üîë SUCESSO! Voc√™ encontra um di√°rio antigo que menciona um 'Selo Quebrado' em uma ru√≠na pr√≥xima.")
            time.sleep(2)
        else:
            print("‚ùå FALHA! A n√©voa e o medo obscurecem seus pensamentos. Voc√™ n√£o encontra nada de √∫til.")
            time.sleep(2)

    # CEN√ÅRIO 2: O Combate
    print("\nAo sair da cabana (ou seguir adiante), um animal corrompido pela N√©voa salta na sua frente!")
    monstro = Monstro("C√£o da N√©voa", vida=20, dano=8, dificuldade_base=13)
    combate_simples(jogador, monstro)
    time.sleep(2)
    
    if jogador.vida > 0:
        print("\nO caminho agora est√° livre. Voc√™ avan√ßa, determinado a encontrar a ru√≠na.")
        print("Fim da demo. Seu aventureiro sobreviveu!")
        jogador.mostrar_status()

# --- 5. EXECU√á√ÉO PRINCIPAL ---

def main():
    jogador = criar_personagem()
    introducao_e_primeira_aventura(jogador)

if __name__ == "__main__":
    main()